# Observations

The observations interface provides convenient access to configuration, metrics and other observer data that has been collected during the execution. It can significantly reduce the effort to manage, retrieve and plot results.

::: tip
Refer to the [Component section](./components.md#self-observer) to learn more about how observation data is being created.
:::

Whenever you execute a task, machinable generates a unique 6-digit (e.g. `OY1p1o`) storage directory that contains all the data generated by the task, including the used configuration, system metrics, status information and results. The observation interface provides high-level access to this data and allows you to query the results like a database.

The observation interface is read-only, meaning it will never modify or remove data generated during the execution.

## Loading observations

To load observations from a storage location, instantiate an instance of the ``Observations`` interface:

```python
from machinable import Observations
mlo = Observations('~/path/to/storage-location')
```

You can combine different storage locations into the same interface using the `add()` method:

```python
mlo.add('~/path/to-another/storage-location')
```

Loaded observations are cached locally to enable reload-free fast access even if the storage location is remote. However, if the task is still running, you can manually trigger a reload of an observation storage using `refresh()`. To unload storage locations you can trigger `remove()` or `reset()`.

## Selecting observations

The interface builds a database of the available observations and provides a variety of methods to select relevant observations:

```python
# select all available observations
observations = mlo.all()
# find observation by its id
observations = mlo.find('UMPybIGO9kR7Hr2YNlOz')
# select all observations that have been generated by a task ...
observations = mlo.find_by_task('bgC2uV')
observations = mlo.find_by_task_name('random_forest')
# ... or that where generated by a particular node ...
observations = mlo.find_by_node('mnist')
# ... or simply the observations of the most recently created task
observations = mlo.find_by_most_recent_task()
```

 The interface also supports customized selection using the [query builder](../reference/observations.md#observationsquerybuilder):

```python
obs = mlo.query.where_task('bgC2uV').rerun(2).has_code_backup().get()
```

## Working with observations

The selected [observation object](../reference/observations.md#observation) provides convenient access to the collected data, for example:

```python
# general information about execution, storage and the task etc.
observation.is_finished()
observation.storage
observation.task.id

# information about the used component and its configuration
print(f"'{observation.task.id}' used dataset '{observation.config.dataset}'")

# log file
print(observation.log)
# >>> 2019-04-01 13:51:40,339; INFO: Hello from the log file

# custom objects that have been stored during the run
my_data = observation.store('data.p')

# tabular record data
records = observation.records   # returns a records interface
# find the 3rd row
records.find(3)
# >>> {'_iteration': 3, ... }
# retrieve all records
all_records = records.find()  # returns a collection
# ... and use standard collection manipulations
print(all_records.avg('accuracy'))
# >>> 34.3212
```

If you have selected more than one observation (e.g. `mlo.find_all()`) the interface will return a [collection](../reference/observations.md#collection) of observation objects. The collection class provides a fluent, straight-forward wrapper for working and manipulating the list.

```python
collection = mlo.all()  # returns a collection of observation objects
# collections can be fluently manipulated
filtered = collection.filter(lambda x: x.attr != 0).take(3).unique()
# use all() to retrive the underlying list
elements = filtered.all()
```

The interface provides a wealth of options to efficiently retrieve and analyse results. Explore the [observations reference](../reference/observations.md#observations-2) for more examples.
